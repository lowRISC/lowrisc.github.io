<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><base href=https://www.lowrisc.org><link rel=icon type=image/png sizes=32x32 href=/favicon.png><title>Build your own bitstream and images &middot; lowRISC: Collaborative open silicon engineering</title><link href=/main.b0a63.css rel=stylesheet><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53520714-1','auto');ga('send','pageview');}</script></head><body><header><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class=navbar-brand href=#><img src=/img/logo/logo-dualcolor.svg alt=lowRISC></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a href=/our-work class=nav-link>Our work</a></li><li class=nav-item><a href=/open-silicon class=nav-link>Open Silicon</a></li><li class=nav-item><a href=/community class=nav-link>Community</a></li><li class=nav-item><a href=/blog class=nav-link>Blog</a></li><li class=nav-item><a href=/jobs class=nav-link>Jobs</a></li><li class=nav-item><a href=/about class=nav-link>About us</a></li><li class=nav-item><a class="btn lr-navbar-btn-gh" href=https://github.com/lowrisc>GitHub</a></li></ul></div></div></nav></header><main role=main><div class=container><h1>Build your own bitstream and images</h1><h3 id=generate-the-bitstream:63e4d7c38a403be6b884c904a2751f72>Generate the bitstream</h3><h4 id=fpga-demo-with-ethernet-default-bootloader:63e4d7c38a403be6b884c904a2751f72>FPGA demo with Ethernet (default bootloader)</h4><pre><code>cd $TOP/fpga/board/nexys4_ddr
make cleanall
make bitstream
</code></pre><p>The generated bitstream is located at <code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.bit</code>.
This will take some time (20-60 minutes depending on your computer).</p><h3 id=program-the-bootloader-on-fpga:63e4d7c38a403be6b884c904a2751f72>Program the bootloader on FPGA</h3><p>Next, turn on the FPGA board and connect the USB cable. Now you
download the bitstream to the quad-SPI on the FPGA board:</p><pre><code>make cfgmem
make program-cfgmem
</code></pre><p>At this point, you should check the MODE jumper is in QSPI mode and then press the PROG button.</p><h3 id=boot-linux-remotely-on-fpga:63e4d7c38a403be6b884c904a2751f72>Boot Linux remotely on FPGA</h3><pre><code>make etherboot
</code></pre><h4 id=fpga-demo-with-ethernet-alternative-boot-programs:63e4d7c38a403be6b884c904a2751f72>FPGA demo with Ethernet (alternative boot programs)</h4><pre><code>cd $TOP/fpga/board/nexys4_ddr
make cleanall
make target (where target is eth, selftest, dram, hello etc.)
</code></pre><p>The generated bitstream is located at <code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.new.bit</code>.
This will take some time (20-60 minutes depending on your computer).</p><h3 id=program-the-alternative-boot-programs-on-fpga:63e4d7c38a403be6b884c904a2751f72>Program the alternative boot programs on FPGA</h3><p>Next, turn on the FPGA board and connect the USB cable. Now you
download the bitstream to the quad-SPI on the FPGA board:</p><pre><code>make cfgmem-updated
make program-cfgmem-updated
</code></pre><h3 id=build-linux-and-early-stage-root-filing-system:63e4d7c38a403be6b884c904a2751f72>Build Linux and early stage root filing system</h3><pre><code>make verilog (automatically included if make bitstream is done above)

$TOP/riscv-tools/make_root.sh
</code></pre><p>If everything runs OK, you should have a boot.bin file.</p><p>Please note that the Berkeley bootloader used by the Linux kernel relies on a header file (<code>dev_map.h</code>) generated by the Rocket chip (automatically generated by the Chisel compilation process).
Normally FPGA bitstream should be generated before building a kernel image.
If you like to generate a kernel image without a bitstream, run the following to produce the header file:</p><pre><code>cd $TOP/fpga/board/nexys4_ddr
CONFIG=Nexys4Config make verilog
</code></pre><h3 id=build-riscv-poky:63e4d7c38a403be6b884c904a2751f72>Build riscv-poky</h3><pre><code>cd $TOP/ricv-poky
source oe-init-build-env
bitbake core-image-riscv
</code></pre><p>This scripting system generates a huge set of downloads, all of which are built from source. This can take half or day on a fast connection and consumes 26GBytes or so of disk space. For these reasons, unless there is a need to modify the installed packages, the user who wishes to quick start might prefer to download the prebuild image. The source code is similar to the standard riscv-poky but with some customisation of device names and configuration.</p><h2 id=useful-makefile-targets:63e4d7c38a403be6b884c904a2751f72>Useful Makefile targets</h2><h4 id=make-project:63e4d7c38a403be6b884c904a2751f72><code>make project</code></h4><p>Generate a Vivado project.</p><h4 id=make-verilog:63e4d7c38a403be6b884c904a2751f72><code>make verilog</code></h4><p>Run Chisel compiler and generate the Verilog files for Rocket chip.</p><h4 id=make-vivado:63e4d7c38a403be6b884c904a2751f72><code>make vivado</code></h4><p>Open the Vivado GUI using the current project.</p><h4 id=make-bitstream:63e4d7c38a403be6b884c904a2751f72><code>make bitstream</code></h4><p>Generate the default bitstream according to the <code>CONFIG</code> in Makefile and the program loaded in <code>src/boot.mem</code>. The default bitstream is generated at <code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.bit</code></p><h4 id=make-hello-dram-sdcard-boot-jump-trace-flash:63e4d7c38a403be6b884c904a2751f72><code>make &lt;hello|dram|sdcard|boot|jump|trace|flash&gt;</code></h4><p>Generate bitstreams for bare-metal tests:</p><ul><li><strong>hello</strong> A hello world program.</li><li><strong>dram</strong> A DDR RAM test.</li><li><strong>selftest</strong> A SD card read/write test and bare-metal debugging utility.</li><li><strong>boot</strong> A 1st bootloader that loads <code>boot.bin</code> from SD to DDR RAM and executes <code>boot.bin</code> afterwards.</li><li><strong>jump</strong> A 1st stage booloader that directly jumps to DDR RAM.</li><li><strong>trace</strong> A software trace demo.</li><li><strong>flash</strong> Read the content of the on-board Flash.</li></ul><p>For each bare-metal test <code>&lt;test&gt;</code>, the executable is generated to
<code>examples/&lt;test&gt;.riscv</code>. It is also converted into a hex
file and copied to <code>src/boot.mem</code>, which then changes the default program for
<code>make bitstream</code> and <code>make simulation</code>. The updated bitstream is generated at
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.new.bit</code></p><h4 id=make-program-program-updated:63e4d7c38a403be6b884c904a2751f72><code>make &lt;program|program-updated&gt;</code></h4><p>Download a bitstream to FPGA. Use <code>program</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.bit</code> and
<code>program-updated</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.new.bit</code></p><h4 id=make-cfgmem-cfgmem-updated:63e4d7c38a403be6b884c904a2751f72><code>make &lt;cfgmem|cfgmem-updated&gt;</code></h4><p>Convert a bitstream to the format suitable for quad-SPI flash on the FPGA board. Use <code>cfgmem</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.bit</code> and
<code>cfgmem-updated</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.new.bit</code></p><h4 id=make-program-cfgmem-program-cfgmem-updated:63e4d7c38a403be6b884c904a2751f72><code>make &lt;program-cfgmem|program-cfgmem-updated&gt;</code></h4><p>Download a bitstream to quad-SPI flash on the FPGA board. Use <code>program-cfgmem</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.bit</code> and
<code>program-cfgmem-updated</code> for
<code>lowrisc-chip-imp/lowrisc-chip-imp.runs/impl_1/chip_top.new.bit</code></p><h4 id=make-clean-cleanall:63e4d7c38a403be6b884c904a2751f72><code>make &lt;clean|cleanall&gt;</code></h4><p><code>make clean</code> will remove all generated code without removing the Vivado
project files. To remove all files including the Vivado project, use <code>make
cleanall</code>.</p></div></main><footer class=lr-footer><div class=container><div class=row><div class="col-lg-2 d-none d-lg-block"><img src=/img/logo/logo-dualcolor.svg width=150px></div><div class=col><p><small>The text content on this website is licensed under a <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>, except where otherwise noted. No license is granted for logos or other trademarks. Other content &copy; lowRISC Contributors.</small></p><p><small><a href=/privacy-policy>Privacy and cookies policy</a>
&middot; <a href=/usage-licence>Usage licence</a></small></p></div><div class=col-lg-2><p><a href=#>Back to top</a></p></div></div></div></footer><script src=/main.b0a63.js></script></body></html>