<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><base href=https://www.lowrisc.org><link rel=icon type=image/png sizes=32x32 href=/favicon.png><title>Linux kernel build step &middot; lowRISC: Collaborative open silicon engineering</title><link href=/main.b716e.css rel=stylesheet></head><body><header><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class=navbar-brand href=#><img src=/img/logo/logo-dualcolor.svg alt=lowRISC></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a href=/our-work class=nav-link>Our work</a></li><li class=nav-item><a href=/open-silicon class=nav-link>Open Silicon</a></li><li class=nav-item><a href=/community class=nav-link>Community</a></li><li class=nav-item><a href=/news class=nav-link>News</a></li><li class=nav-item><a href=/jobs class=nav-link>Jobs</a></li><li class=nav-item><a href=/about class=nav-link>About us</a></li><li class=nav-item><a class="btn lr-navbar-btn-gh" href=https://github.com/lowrisc>GitHub</a></li></ul></div></div></nav></header><main role=main><div class=container><h1>Linux kernel build step</h1><h2 id=what-s-this-all-about:0592055f087b3931d97cea733a6d1cba>What&rsquo;s this all about?</h2><p>Most of the support for RISCV specific development has taken place on very new versions of Linux.
A fully generic kernel is hard to achieve given all the possible scenarios
where RISCV could be used. Nevertheless certain helperss are assumed to be
always available which simplify matters:</p><ol><li>The Kernel entry address is 0x80200000</li><li>Berkeley boot loader (BBL) handles the initial console output using it&rsquo;s SBI interface</li><li>A device tree blob (DTB) is passed to Linux to enable it to decide which devices to enable. This blob is analogous to the BIOS settings in a traditional PC.</li></ol><p>In addition an initial root filing system is needed to allow site specific
configuration. This initial filesystem is responsible for loading the real
rootfs, which might be on SD card or NFS.</p><p>The initial boot environment will interrogate the FPGA switch settings to decide how to boot:</p><table><thead><tr><th>FPGA Switch:</th><th>15..12</th><th>11..8</th><th>7..4</th><th>3..0</th></tr></thead><tbody><tr><td>Don&rsquo;t boot</td><td></td><td></td><td></td><td>0000</td></tr><tr><td>GDB boot</td><td></td><td></td><td></td><td>00?1</td></tr><tr><td>SD boot</td><td></td><td></td><td></td><td>0010</td></tr><tr><td>DHCP boot</td><td></td><td></td><td></td><td>0100</td></tr><tr><td>SD root</td><td></td><td></td><td>0000</td><td></td></tr><tr><td>NFS root</td><td></td><td></td><td>0001</td><td></td></tr><tr><td>Custom root</td><td></td><td></td><td>001?</td><td></td></tr><tr><td>Reserved</td><td></td><td></td><td>01??</td><td></td></tr><tr><td>Reserved</td><td></td><td></td><td>1???</td><td></td></tr><tr><td>Reserved</td><td></td><td>????</td><td></td><td></td></tr><tr><td>MAC LSB</td><td>????</td><td></td><td></td><td></td></tr></tbody></table><p>The LSB of the switches determines the boot address and should always be off unless GDB is in use. The SD boot and DHCP boot switches are interpreted by the boot loader to determine whether to check for an SD-Card presence or not. The SD root and NFS root options are determined by Linux using the /dev/gpio0 device, which also controls the LEDs. The decision making code is in debian-riscv64/work/busyboxinit.sh and is interpreted as an ash shell script. If a custom option is chosen the DOS partition the card will be mounted to search for further customisations (such as an address of a server to search for).</p><h3 id=you-should-already-have-prepared-a-cpio-archive-in-the-debian-directory-if-not-visit-here-first:0592055f087b3931d97cea733a6d1cba>You should already have prepared a cpio archive in the Debian directory. If not, visit here first:</h3><ul><li><a href=https://www.lowrisc.org/docs/download-install-debian/>Downloading and Installing Debian</a></li></ul><p>or generate directly with this command:</p><pre><code>make -C ../debian-riscv64 cpio
</code></pre><p>or copy from the quickstart binary release:</p><pre><code>wget https://github.com/lowRISC/lowrisc-chip/releases/download/v0.6-rc3/initramfs.cpio
</code></pre><h2 id=configuring-and-building-the-linux-kernel-independent-of-the-device-tree-blob:0592055f087b3931d97cea733a6d1cba>Configuring and building the Linux kernel (independent of the device tree blob)</h2><pre><code>cd $TOP/riscv-linux
make ARCH=riscv defconfig
make ARCH=riscv -j 4 CROSS_COMPILE=riscv64-unknown-linux-gnu- CONFIG_INITRAMFS_SOURCE=&quot;initramfs.cpio&quot;
</code></pre><p>The next recommended step is:</p><ul><li><a href=https://www.lowrisc.org/docs/build-berkeley-boot-loader/>Build the Berkeley boot loader (BBL)</a></li></ul></div></main><footer class=lr-footer><div class=container><div class=row><div class="col-lg-2 d-none d-lg-block"><img src=/img/logo/logo-dualcolor.svg width=150px></div><div class=col><p><small>The text content on this website is licensed under a <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>, except where otherwise noted. No license is granted for logos or other trademarks. Other content &copy; lowRISC Contributors.</small></p><p><small><a href=/privacy-policy>Privacy and cookies policy</a>
&middot; <a href=/usage-licence>Usage licence</a></small></p></div><div class=col-lg-2><p><a href=#>Back to top</a></p></div></div></div></footer><script src=/main.b716e.js></script></body></html>